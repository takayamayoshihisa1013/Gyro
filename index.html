<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <title>加速度センサーのテスト</title>
</head>

<body>
    <h1>スマホを振ってください</h1>
    <div id="output"></div>

    <script>
        const output = document.getElementById("output");

        // iOS Safari ではユーザーの許可が必要
        function requestPermission() {
            if (typeof DeviceMotionEvent.requestPermission === "function") {
                DeviceMotionEvent.requestPermission()
                    .then(permissionState => {
                        if (permissionState === "granted") {
                            window.addEventListener("devicemotion", handleMotion);
                        }
                    })
                    .catch(console.error);
            } else {
                // AndroidやPCブラウザは許可不要
                window.addEventListener("devicemotion", handleMotion);
            }
        }

        function handleMotion(event) {
            const acc = event.accelerationIncludingGravity;
            if (acc) {
                const x = acc.x?.toFixed(2);
                const y = acc.y?.toFixed(2);
                const z = acc.z?.toFixed(2);

                output.innerHTML = `加速度<br>
          X: ${x}<br>
          Y: ${y}<br>
          Z: ${z}`;

                // 簡単な「振った」判定
                const threshold = 15; // 加速度のしきい値
                if (Math.abs(x) > threshold || Math.abs(y) > threshold || Math.abs(z) > threshold) {
                    output.innerHTML += "<br><b>振った！</b>";
                }
            }
        }

        // ページをタップして許可を求める
        document.body.addEventListener("click", requestPermission);
    </script>
</body>

</html>