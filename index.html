<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="UTF-8">
  <title>加速度センサーのテスト</title>
</head>

<body>
  <h1>スマホを振ってください</h1>
  <button id="startBtn">センサー開始</button>
  <div id="output"></div>

  <script>
    const output = document.getElementById("output");
    const startBtn = document.getElementById("startBtn");

    function log(message) {
      console.log(message);
      output.innerHTML += `<div>${message}</div>`;
    }

    function requestPermission() {
      log("requestPermission 呼び出し");

      if (typeof DeviceMotionEvent !== "undefined" &&
          typeof DeviceMotionEvent.requestPermission === "function") {
        // iOS Safari
        DeviceMotionEvent.requestPermission()
          .then(permissionState => {
            log("permissionState: " + permissionState);
            if (permissionState === "granted") {
              window.addEventListener("devicemotion", handleMotion);
              log("イベントリスナー登録 (iOS)");
            } else {
              log("センサー利用が拒否されました");
            }
          })
          .catch(err => log("エラー: " + err));
      } else {
        // Android Chrome 等
        window.addEventListener("devicemotion", handleMotion);
        log("イベントリスナー登録 (Android/PC)");
      }
    }

    function handleMotion(event) {
      const acc = event.accelerationIncludingGravity;
      if (acc) {
        const x = acc.x?.toFixed(2);
        const y = acc.y?.toFixed(2);
        const z = acc.z?.toFixed(2);

        output.innerHTML = `
          加速度:<br>
          X: ${x}<br>
          Y: ${y}<br>
          Z: ${z}`;
      } else {
        log("accelerationIncludingGravity が null");
      }
    }

    startBtn.addEventListener("click", requestPermission);
  </script>
</body>

</html>
